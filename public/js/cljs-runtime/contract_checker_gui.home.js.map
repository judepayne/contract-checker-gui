{"version":3,"sources":["contract_checker_gui/home.cljs"],"mappings":";;;;;;;;;AAYA,AAAKA,AAAI,AAAOC;AAIhB,AAAKC,AACH,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAACC;AAQH,AAAA,AAAME,AAAeC;AAArB,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAIa,AAAA,AAAA,AAAAG,AAAmBD;AAJhC,AAOkB,AAAA,AAACE,AAAMF,AAAMG,AAAuB,AAAA,AAAAL;;;AAEtD,AAAA,AAAMO,AAAeL;AAArB,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAI,AAIa,AAAA,AAAA,AAAAH,AAAmBD;AAJhC,AAOkB,AAAA,AAACE,AAAMF,AAAMG,AAAuB,AAAA,AAAAC;;;AAEtD,AAAA,AAAKE;AAEL,AAAA,AAAMC;AAAN,AAAmB,AAAA,AAAA,AAAA,AACO,AAAA,AAAA,AAAAN,AAAmBL,AAEnB,AAAA,AAAA,AAAAK,AAAmBL;;AAI7C,AAAA,AAAMY,AACHC;AADH,AAEE,AAAYC,AAAQ,AAACC,AAAQF;;AAG/B,AAAA,AAAMG,AACHH;AADH,AAEE,AAACf,AAAAA,AAAAA,AAAIe,AAAAA;;AACL,AAAA,AAAA,AAACI,AAAQ,AAAQH,AAAQD;;AAG3B,AAAA,AAAMK,AAAMC,AAAIC;AAAhB,AACE,AAAAC,AACqB,AAACU,AAAQ,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAACC,AAAoBb,AAECC,AAG3B,AAAKa;AAAL,AAAQ,AAAAC,AAAA;AAAAC,AAAC,AAACC,AAAQH;AAAV,AAAA,AAAAE,AAAAA,AAAAD,AAAAC,AAAAD;AANjC,AAAAZ;AAAA,AAAA,AAAAC,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAAE,AAAAC,AAAAH,AAAAA;AAAA,AAAAI,AAAAJ,AAAA,AAAiBM;AAAjB,AAAAF,AAAAJ,AAAA,AAAwBO;AAAxB,AAAA,AAAAF,AAAA,AAOWE;;;AAGb,AAAA,AAAMO,AAAYC;AAAlB,AACE,AAACxC,AAAAA,AAAAA,AAAIwC,AAAAA;;AACL,AAAA,AAAChC,AAAMN,AAAYO,AAAc+B;;AAGnC,AAAA,AAAMC;AAAN,AAIO,AAACE,AAAQ,AAAKC;AAAL,AAAY,AAACL,AAAW,AAAWK;AAH5C,AAACxB,AAAKR,AAAQ,AAACC,AACf,AAAC6B,AAAMxB,AACP,AAACwB,AAAMH;;AAId,AAAA,AAAMM;AAAN,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAEqBJ;;AAIrB,AAAA,AAAMK;AAAN,AACE;AAAA,AAAA,AAAA,AAAA,AAAAvC,AAAYL;;;AAGd,AAAA,AAAM6C;AAAN,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAIK1C,AAAcH,AACdS,AAAcT,AACd2C,AACAC,AAED,AAAA,AAAA,AAAAvC,AAAUL","names":["contract-checker-gui.home/log","js/console","contract-checker-gui.home/local-state","reagent.core.atom.cljs$core$IFn$_invoke$arity$1","p1__48825#","contract-checker-gui.home/producer-area","state","cljs.core/deref","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$4","cljs.core/assoc","p1__48826#","contract-checker-gui.home/consumer-area","contract-checker-gui.home/aws-url","contract-checker-gui.home/json-data","contract-checker-gui.home/clj->json","ds","js/JSON","cljs.core/clj->js","contract-checker-gui.home/json->clj","cljs.core.js__GT_clj.cljs$core$IFn$_invoke$arity$variadic","contract-checker-gui.home/post","url","json-data","promesa.core/bind","p__48829","map__48830","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","promesa.core/promise","status","body","promesa.core.catch$.cljs$core$IFn$_invoke$arity$2","kvlt.core/request!","e","G__48828","fexpr__48827","cljs.core/ex-data","contract-checker-gui.home/put-result","result","contract-checker-gui.home/compare-contract","promesa.core/map","promesa.core.error.cljs$core$IFn$_invoke$arity$2","error","contract-checker-gui.home/compare-button","contract-checker-gui.home/display-errors","contract-checker-gui.home/home-page"],"sourcesContent":["(ns contract-checker-gui.home\r\n  (:require\r\n   [reagent.core             :refer [atom cursor create-class dom-node force-update]]\r\n   [reagent.ratom            :refer [reaction make-reaction]]\r\n   [accountant.core          :as accountant]\r\n   [kvlt.core                :as kvlt]\r\n   [promesa.core             :as p]\r\n   [promesa.async-cljs       :refer-macros [async]]\r\n   [goog.dom                 :as dom]))\r\n\r\n\r\n;; Useful for debugging into the Chrome console.\r\n(def log (.-log js/console))\r\n\r\n\r\n;; State\r\n(def local-state\r\n  (atom\r\n   {:producer-schema \"\"\r\n    :consumer-schema \"\"\r\n    :svg \"<div />\"\r\n    :errors \"\"}))\r\n\r\n\r\n\r\n(defn producer-area [state]\r\n  [:textarea\r\n     {:id \"producer-area\"\r\n      :placeholder \"Paste the producer schema here\"\r\n      :value (:producer-schema @state)\r\n      :rows 12\r\n      :cols 50\r\n      :on-change #(swap! state assoc :producer-schema (-> % .-target .-value) )}])\r\n\r\n(defn consumer-area [state]\r\n  [:textarea\r\n     {:id \"consumer-area\"\r\n      :placeholder \"Paste the consumer schema here\"\r\n      :value (:consumer-schema @state)\r\n      :rows 12\r\n      :cols 50\r\n      :on-change #(swap! state assoc :consumer-schema (-> % .-target .-value) )}])\r\n\r\n(def aws-url \"https://8ty9wnwd19.execute-api.eu-west-2.amazonaws.com/beta\")\r\n\r\n(defn json-data [] (str \"{\\\"consumer\\\": \" \r\n                          (:consumer-schema @local-state)\r\n                          \",\\\"producer\\\": \"\r\n                          (:producer-schema @local-state)\r\n                          \"}\"))\r\n\r\n\r\n(defn clj->json\r\n  [ds]\r\n  (.stringify js/JSON (clj->js ds)))\r\n\r\n\r\n(defn json->clj\r\n  [ds]\r\n  (log ds)\r\n  (js->clj (.parse js/JSON ds) :keywordize-keys true))\r\n\r\n\r\n(defn post [url json-data]\r\n  (p/alet [{:keys [status body]}\r\n              (p/await (p/catch (kvlt/request! {:url url\r\n                                                :method :post\r\n                                                :body json-data\r\n                                                :content-type :json\r\n                                                :accept :json})\r\n                           (fn [e] ((ex-data e) :type))))]\r\n             body))\r\n\r\n\r\n(defn put-result [result]\r\n  (log result)\r\n  (swap! local-state assoc :errors result))\r\n\r\n\r\n(defn compare-contract []\r\n  (->> (post aws-url (json-data))\r\n       (p/map json->clj)\r\n       (p/map put-result)\r\n       (p/error (fn [error] (put-result (.-message error))))))\r\n\r\n\r\n(defn compare-button []\r\n  [:button {:id \"compare-button\" \r\n            :onClick compare-contract}\r\n   \"Compare Contracts\"])\r\n\r\n\r\n(defn display-errors []\r\n  (fn [] [:p @local-state]))\r\n\r\n\r\n(defn home-page []\r\n  [:div.page\r\n;   @local-state\r\n   [:div.main\r\n    [producer-area local-state]\r\n    [consumer-area local-state]\r\n    [compare-button]\r\n    [display-errors]\r\n    [:p \"Debug: @local-state\"]]\r\n    (:errors @local-state)\r\n     ])\r\n"]}